<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Configurateur Complet - FLARE CUSTOM</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            background: #f5f5f5;
            color: #333;
        }

        .container {
            display: flex;
            height: 100vh;
            overflow: hidden;
        }

        /* ===== SIDEBAR PRODUITS ===== */
        .sidebar {
            width: 300px;
            background: #fff;
            border-right: 1px solid #ddd;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .sidebar-header {
            padding: 20px;
            background: linear-gradient(135deg, #FF4B26 0%, #E63910 100%);
            color: white;
        }

        .sidebar-header h1 {
            font-size: 18px;
            margin-bottom: 5px;
        }

        .sidebar-header p {
            font-size: 12px;
            opacity: 0.9;
        }

        .search-box {
            padding: 15px;
            border-bottom: 1px solid #eee;
        }

        .search-box input {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }

        .product-list {
            flex: 1;
            overflow-y: auto;
        }

        .product-item {
            padding: 12px 15px;
            border-bottom: 1px solid #eee;
            cursor: pointer;
            transition: background 0.2s;
        }

        .product-item:hover {
            background: #f9f9f9;
        }

        .product-item.active {
            background: #fff5f2;
            border-left: 3px solid #FF4B26;
        }

        .product-item-ref {
            font-size: 11px;
            color: #999;
            margin-bottom: 3px;
        }

        .product-item-name {
            font-size: 14px;
            font-weight: 500;
            color: #333;
        }

        .product-item-sport {
            font-size: 11px;
            color: #666;
            margin-top: 3px;
        }

        /* ===== MAIN CONTENT ===== */
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .top-bar {
            background: #fff;
            padding: 20px 30px;
            border-bottom: 1px solid #ddd;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .top-bar h2 {
            font-size: 24px;
            color: #333;
        }

        .top-bar-actions {
            display: flex;
            gap: 10px;
        }

        /* ===== TABS ===== */
        .tabs {
            background: #fff;
            border-bottom: 1px solid #ddd;
            padding: 0 30px;
            display: flex;
            gap: 5px;
            overflow-x: auto;
        }

        .tab {
            padding: 15px 20px;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
            font-size: 14px;
            font-weight: 500;
            color: #666;
            white-space: nowrap;
        }

        .tab:hover {
            color: #FF4B26;
        }

        .tab.active {
            color: #FF4B26;
            border-bottom-color: #FF4B26;
        }

        /* ===== TAB CONTENT ===== */
        .tab-content {
            flex: 1;
            overflow-y: auto;
            padding: 30px;
        }

        .tab-pane {
            display: none;
        }

        .tab-pane.active {
            display: block;
        }

        /* ===== FORM SECTIONS ===== */
        .form-section {
            background: #fff;
            border-radius: 8px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }

        .form-section h3 {
            font-size: 18px;
            margin-bottom: 20px;
            color: #333;
            padding-bottom: 10px;
            border-bottom: 2px solid #FF4B26;
        }

        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-size: 14px;
            font-weight: 500;
            color: #555;
        }

        .form-group input[type="text"],
        .form-group input[type="number"],
        .form-group input[type="email"],
        .form-group input[type="url"],
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
            font-family: inherit;
            transition: border-color 0.3s;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #FF4B26;
        }

        .form-group textarea {
            min-height: 100px;
            resize: vertical;
        }

        /* ===== TOGGLE SWITCHES ===== */
        .toggle-group {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
        }

        .toggle-switch {
            position: relative;
            width: 50px;
            height: 26px;
        }

        .toggle-switch input {
            display: none;
        }

        .toggle-slider {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: #ccc;
            border-radius: 26px;
            cursor: pointer;
            transition: 0.3s;
        }

        .toggle-slider:before {
            content: "";
            position: absolute;
            height: 20px;
            width: 20px;
            left: 3px;
            bottom: 3px;
            background: white;
            border-radius: 50%;
            transition: 0.3s;
        }

        .toggle-switch input:checked + .toggle-slider {
            background: #FF4B26;
        }

        .toggle-switch input:checked + .toggle-slider:before {
            transform: translateX(24px);
        }

        /* ===== BUTTONS ===== */
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: #FF4B26;
            color: white;
        }

        .btn-primary:hover {
            background: #E63910;
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-secondary:hover {
            background: #5a6268;
        }

        .btn-success {
            background: #28a745;
            color: white;
        }

        .btn-danger {
            background: #dc3545;
            color: white;
        }

        .btn-small {
            padding: 6px 12px;
            font-size: 12px;
        }

        /* ===== PHOTO GALLERY ===== */
        .photo-gallery {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .photo-item {
            position: relative;
            aspect-ratio: 1;
            border: 2px solid #ddd;
            border-radius: 8px;
            overflow: hidden;
            cursor: move;
        }

        .photo-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .photo-item-actions {
            position: absolute;
            top: 5px;
            right: 5px;
            display: flex;
            gap: 5px;
            opacity: 0;
            transition: opacity 0.3s;
        }

        .photo-item:hover .photo-item-actions {
            opacity: 1;
        }

        .photo-item-badge {
            position: absolute;
            bottom: 5px;
            left: 5px;
            background: rgba(0,0,0,0.7);
            color: white;
            padding: 3px 8px;
            border-radius: 3px;
            font-size: 11px;
        }

        .photo-upload {
            border: 2px dashed #ddd;
            border-radius: 8px;
            padding: 40px 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }

        .photo-upload:hover {
            border-color: #FF4B26;
            background: #fff5f2;
        }

        .photo-upload input[type="file"] {
            display: none;
        }

        /* ===== TEMPLATE GALLERY ===== */
        .template-gallery {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .template-item {
            border: 2px solid #ddd;
            border-radius: 8px;
            overflow: hidden;
            transition: all 0.3s;
            cursor: pointer;
        }

        .template-item:hover {
            border-color: #FF4B26;
            box-shadow: 0 4px 12px rgba(255,75,38,0.2);
        }

        .template-item-preview {
            width: 100%;
            aspect-ratio: 3/4;
            background: #f5f5f5;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .template-item-preview img {
            max-width: 100%;
            max-height: 100%;
        }

        .template-item-info {
            padding: 12px;
            background: white;
        }

        .template-item-name {
            font-size: 14px;
            font-weight: 500;
            margin-bottom: 5px;
        }

        .template-item-tags {
            font-size: 11px;
            color: #999;
        }

        .template-item-actions {
            display: flex;
            gap: 5px;
            padding: 8px 12px;
            border-top: 1px solid #eee;
        }

        /* ===== SIZE GUIDE SELECTION ===== */
        .size-guide-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-top: 20px;
        }

        .size-guide-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            background: white;
            border: 1px solid #ddd;
            border-radius: 8px;
        }

        .size-guide-item.selected {
            border-color: #FF4B26;
            background: #fff5f2;
        }

        .size-guide-info h4 {
            font-size: 16px;
            margin-bottom: 5px;
        }

        .size-guide-meta {
            font-size: 12px;
            color: #999;
        }

        /* ===== COLOR PICKER GRID ===== */
        .color-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .color-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px;
            background: #f9f9f9;
            border-radius: 6px;
        }

        .color-preview {
            width: 40px;
            height: 40px;
            border-radius: 4px;
            border: 2px solid #ddd;
            cursor: pointer;
        }

        .color-item input[type="text"] {
            flex: 1;
            padding: 6px 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 12px;
        }

        /* ===== SAVE BAR ===== */
        .save-bar {
            position: fixed;
            bottom: 0;
            left: 300px;
            right: 0;
            background: linear-gradient(135deg, #FF4B26 0%, #E63910 100%);
            color: white;
            padding: 15px 30px;
            display: none;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 -4px 12px rgba(0,0,0,0.1);
            z-index: 1000;
        }

        .save-bar.show {
            display: flex;
        }

        .save-bar-message {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .save-bar-actions {
            display: flex;
            gap: 10px;
        }

        /* ===== LOADING SPINNER ===== */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* ===== EMPTY STATE ===== */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #999;
        }

        .empty-state-icon {
            font-size: 48px;
            margin-bottom: 15px;
        }

        .empty-state h3 {
            font-size: 20px;
            margin-bottom: 10px;
            color: #666;
        }

        /* ===== RESPONSIVE ===== */
        @media (max-width: 968px) {
            .sidebar {
                width: 250px;
            }

            .save-bar {
                left: 250px;
            }
        }

        @media (max-width: 768px) {
            .container {
                flex-direction: column;
            }

            .sidebar {
                width: 100%;
                height: 200px;
            }

            .save-bar {
                left: 0;
            }

            .form-row {
                grid-template-columns: 1fr;
            }
        }

        /* ===== CHECKBOX LIST ===== */
        .checkbox-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 10px;
            margin-top: 10px;
        }

        .checkbox-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .checkbox-item input[type="checkbox"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }

        .checkbox-item label {
            cursor: pointer;
            font-size: 14px;
        }

        /* ===== OPTION BUILDER ===== */
        .option-builder {
            margin-top: 15px;
        }

        .option-item {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
            align-items: center;
        }

        .option-item input {
            flex: 1;
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }

        .badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 3px;
            font-size: 11px;
            font-weight: 500;
        }

        .badge-primary {
            background: #FF4B26;
            color: white;
        }

        .badge-secondary {
            background: #6c757d;
            color: white;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Sidebar Produits -->
        <div class="sidebar">
            <div class="sidebar-header">
                <h1>üîß Configurateur Admin</h1>
                <p>G√©rez tout de A √† Z</p>
            </div>

            <div class="search-box">
                <input type="text" id="searchProducts" placeholder="üîç Rechercher un produit...">
            </div>

            <div class="product-list" id="productList">
                <div class="empty-state">
                    <div class="loading"></div>
                    <p>Chargement des produits...</p>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <div class="top-bar">
                <h2 id="currentProductName">S√©lectionnez un produit</h2>
                <div class="top-bar-actions">
                    <button class="btn btn-secondary" onclick="reloadProduct()">üîÑ Recharger</button>
                    <button class="btn btn-primary" onclick="saveAll()">üíæ Tout Sauvegarder</button>
                </div>
            </div>

            <div class="tabs">
                <div class="tab active" data-tab="infos">üìã Infos G√©n√©rales</div>
                <div class="tab" data-tab="prix">üí∞ Prix</div>
                <div class="tab" data-tab="photos">üì∏ Photos</div>
                <div class="tab" data-tab="configurateur">‚öôÔ∏è Configurateur</div>
                <div class="tab" data-tab="templates">üé® Templates</div>
                <div class="tab" data-tab="guides">üìè Guides Tailles</div>
                <div class="tab" data-tab="contenu">üìù Contenu</div>
            </div>

            <div class="tab-content">
                <!-- TAB: Infos G√©n√©rales -->
                <div class="tab-pane active" id="tab-infos">
                    <div class="form-section">
                        <h3>Informations Produit</h3>
                        <div class="form-row">
                            <div class="form-group">
                                <label>R√©f√©rence *</label>
                                <input type="text" id="reference" required>
                            </div>
                            <div class="form-group">
                                <label>Nom du Produit *</label>
                                <input type="text" id="nom" required>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label>Sport</label>
                                <input type="text" id="sport">
                            </div>
                            <div class="form-group">
                                <label>Famille</label>
                                <input type="text" id="famille">
                            </div>
                            <div class="form-group">
                                <label>Genre</label>
                                <select id="genre">
                                    <option value="Homme">Homme</option>
                                    <option value="Femme">Femme</option>
                                    <option value="Mixte">Mixte</option>
                                    <option value="Enfant">Enfant</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label>Tissu</label>
                                <input type="text" id="tissu">
                            </div>
                            <div class="form-group">
                                <label>Grammage</label>
                                <input type="text" id="grammage">
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Description</label>
                            <textarea id="description"></textarea>
                        </div>
                    </div>
                </div>

                <!-- TAB: Prix -->
                <div class="tab-pane" id="tab-prix">
                    <div class="form-section">
                        <h3>Tarifs D√©gressifs</h3>
                        <p style="margin-bottom: 20px; color: #666;">Configurez les 8 paliers de tarification.</p>
                        <div class="form-row">
                            <div class="form-group">
                                <label>Prix pour 1 pi√®ce (‚Ç¨)</label>
                                <input type="number" id="prix_1" step="0.01" min="0">
                            </div>
                            <div class="form-group">
                                <label>Prix pour 5 pi√®ces (‚Ç¨)</label>
                                <input type="number" id="prix_5" step="0.01" min="0">
                            </div>
                            <div class="form-group">
                                <label>Prix pour 10 pi√®ces (‚Ç¨)</label>
                                <input type="number" id="prix_10" step="0.01" min="0">
                            </div>
                            <div class="form-group">
                                <label>Prix pour 20 pi√®ces (‚Ç¨)</label>
                                <input type="number" id="prix_20" step="0.01" min="0">
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label>Prix pour 50 pi√®ces (‚Ç¨)</label>
                                <input type="number" id="prix_50" step="0.01" min="0">
                            </div>
                            <div class="form-group">
                                <label>Prix pour 100 pi√®ces (‚Ç¨)</label>
                                <input type="number" id="prix_100" step="0.01" min="0">
                            </div>
                            <div class="form-group">
                                <label>Prix pour 250 pi√®ces (‚Ç¨)</label>
                                <input type="number" id="prix_250" step="0.01" min="0">
                            </div>
                            <div class="form-group">
                                <label>Prix pour 500 pi√®ces (‚Ç¨)</label>
                                <input type="number" id="prix_500" step="0.01" min="0">
                            </div>
                        </div>
                    </div>
                </div>

                <!-- TAB: Photos -->
                <div class="tab-pane" id="tab-photos">
                    <div class="form-section">
                        <h3>Galerie Photos</h3>
                        <p style="margin-bottom: 20px; color: #666;">Ajoutez autant de photos que vous voulez. Glissez-d√©posez pour r√©organiser.</p>

                        <div class="photo-upload" onclick="document.getElementById('photoUpload').click()">
                            <input type="file" id="photoUpload" accept="image/*" onchange="uploadPhoto(this)">
                            <div style="font-size: 48px; margin-bottom: 10px;">üì§</div>
                            <div><strong>Cliquez pour uploader une photo</strong></div>
                            <div style="font-size: 12px; color: #999; margin-top: 5px;">JPEG, PNG, WebP (max 5MB)</div>
                        </div>

                        <div class="photo-gallery" id="photoGallery">
                            <!-- Photos charg√©es dynamiquement -->
                        </div>
                    </div>
                </div>

                <!-- TAB: Configurateur -->
                <div class="tab-pane" id="tab-configurateur">
                    <div class="form-section">
                        <h3>√âtape 1: Type de Design</h3>
                        <div class="checkbox-list">
                            <div class="toggle-group">
                                <label class="toggle-switch">
                                    <input type="checkbox" id="allow_design_flare" checked>
                                    <span class="toggle-slider"></span>
                                </label>
                                <label for="allow_design_flare">Design par FLARE</label>
                            </div>
                            <div class="toggle-group">
                                <label class="toggle-switch">
                                    <input type="checkbox" id="allow_design_client" checked>
                                    <span class="toggle-slider"></span>
                                </label>
                                <label for="allow_design_client">Fichiers Client</label>
                            </div>
                            <div class="toggle-group">
                                <label class="toggle-switch">
                                    <input type="checkbox" id="allow_design_template" checked>
                                    <span class="toggle-slider"></span>
                                </label>
                                <label for="allow_design_template">Template</label>
                            </div>
                        </div>
                        <div class="form-group" style="margin-top: 20px;">
                            <label>Co√ªt suppl√©mentaire Design FLARE (‚Ç¨)</label>
                            <input type="number" id="design_flare_extra_cost" step="0.01" value="50.00">
                        </div>
                    </div>

                    <div class="form-section">
                        <h3>√âtape 2: Options Produit</h3>
                        <div class="form-group">
                            <label>Options Col (s√©par√©es par virgule)</label>
                            <input type="text" id="available_col_options" placeholder="Rond, V, Polo, Capuche">
                        </div>
                        <div class="form-group">
                            <label>Options Manches (s√©par√©es par virgule)</label>
                            <input type="text" id="available_manches_options" placeholder="Courtes, Longues, Sans manches">
                        </div>
                        <div class="form-group">
                            <label>Options Poches (s√©par√©es par virgule)</label>
                            <input type="text" id="available_poches_options" placeholder="Oui, Non">
                        </div>
                        <div class="form-group">
                            <label>Options Fermeture (s√©par√©es par virgule)</label>
                            <input type="text" id="available_fermeture_options" placeholder="√âlastique, Zip, Boutons">
                        </div>
                    </div>

                    <div class="form-section">
                        <h3>√âtape 3: Genre</h3>
                        <div class="checkbox-list">
                            <div class="toggle-group">
                                <label class="toggle-switch">
                                    <input type="checkbox" id="allow_genre_homme" checked>
                                    <span class="toggle-slider"></span>
                                </label>
                                <label for="allow_genre_homme">Homme</label>
                            </div>
                            <div class="toggle-group">
                                <label class="toggle-switch">
                                    <input type="checkbox" id="allow_genre_femme" checked>
                                    <span class="toggle-slider"></span>
                                </label>
                                <label for="allow_genre_femme">Femme</label>
                            </div>
                            <div class="toggle-group">
                                <label class="toggle-switch">
                                    <input type="checkbox" id="allow_genre_mixte" checked>
                                    <span class="toggle-slider"></span>
                                </label>
                                <label for="allow_genre_mixte">Mixte</label>
                            </div>
                            <div class="toggle-group">
                                <label class="toggle-switch">
                                    <input type="checkbox" id="allow_genre_enfant" checked>
                                    <span class="toggle-slider"></span>
                                </label>
                                <label for="allow_genre_enfant">Enfant</label>
                            </div>
                        </div>
                        <div class="form-group" style="margin-top: 20px;">
                            <label>Remise Enfant (%)</label>
                            <input type="number" id="enfant_discount_percent" step="0.01" value="10.00">
                        </div>
                    </div>

                    <div class="form-section">
                        <h3>√âtape 4: Tailles</h3>
                        <div class="form-group">
                            <label>Tailles Disponibles</label>
                            <div class="checkbox-list">
                                <div class="checkbox-item">
                                    <input type="checkbox" id="size_xs" value="XS">
                                    <label for="size_xs">XS</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="size_s" value="S">
                                    <label for="size_s">S</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="size_m" value="M">
                                    <label for="size_m">M</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="size_l" value="L">
                                    <label for="size_l">L</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="size_xl" value="XL">
                                    <label for="size_xl">XL</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="size_xxl" value="XXL">
                                    <label for="size_xxl">XXL</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="size_3xl" value="3XL">
                                    <label for="size_3xl">3XL</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="size_4xl" value="4XL">
                                    <label for="size_4xl">4XL</label>
                                </div>
                            </div>
                        </div>
                        <div class="form-row" style="margin-top: 20px;">
                            <div class="form-group">
                                <label>Quantit√© Totale Minimum</label>
                                <input type="number" id="min_total_quantity" value="1">
                            </div>
                            <div class="form-group">
                                <label>Quantit√© Totale Maximum</label>
                                <input type="number" id="max_total_quantity" value="9999">
                            </div>
                        </div>
                    </div>

                    <div class="form-section">
                        <h3>√âtape 5: Personnalisation</h3>

                        <h4 style="margin-bottom: 15px;">Couleurs</h4>
                        <div class="toggle-group">
                            <label class="toggle-switch">
                                <input type="checkbox" id="allow_colors" checked>
                                <span class="toggle-slider"></span>
                            </label>
                            <label for="allow_colors">Autoriser la s√©lection de couleurs</label>
                        </div>
                        <div class="form-group" style="margin-top: 15px;">
                            <label>Couleurs par d√©faut</label>
                            <div class="color-grid" id="colorGrid">
                                <!-- Couleurs ajout√©es dynamiquement -->
                            </div>
                            <button class="btn btn-secondary btn-small" onclick="addColor()" style="margin-top: 10px;">+ Ajouter une couleur</button>
                        </div>

                        <hr style="margin: 30px 0; border: none; border-top: 1px solid #eee;">

                        <h4 style="margin-bottom: 15px;">Logos</h4>
                        <div class="toggle-group">
                            <label class="toggle-switch">
                                <input type="checkbox" id="allow_logos" checked>
                                <span class="toggle-slider"></span>
                            </label>
                            <label for="allow_logos">Autoriser les logos</label>
                        </div>
                        <div class="form-group" style="margin-top: 15px;">
                            <label>Co√ªt suppl√©mentaire par logo (‚Ç¨)</label>
                            <input type="number" id="logo_extra_cost" step="0.01" value="0.00">
                        </div>

                        <hr style="margin: 30px 0; border: none; border-top: 1px solid #eee;">

                        <h4 style="margin-bottom: 15px;">Num√©ros</h4>
                        <div class="toggle-group">
                            <label class="toggle-switch">
                                <input type="checkbox" id="allow_numeros" checked>
                                <span class="toggle-slider"></span>
                            </label>
                            <label for="allow_numeros">Autoriser les num√©ros</label>
                        </div>
                        <div class="form-row" style="margin-top: 15px;">
                            <div class="toggle-group">
                                <label class="toggle-switch">
                                    <input type="checkbox" id="allow_numeros_generique" checked>
                                    <span class="toggle-slider"></span>
                                </label>
                                <label for="allow_numeros_generique">Num√©ros g√©n√©riques (1-20, gratuit)</label>
                            </div>
                            <div class="toggle-group">
                                <label class="toggle-switch">
                                    <input type="checkbox" id="allow_numeros_specifique" checked>
                                    <span class="toggle-slider"></span>
                                </label>
                                <label for="allow_numeros_specifique">Num√©ros sp√©cifiques (payant)</label>
                            </div>
                        </div>
                        <div class="form-group" style="margin-top: 15px;">
                            <label>Co√ªt num√©ros sp√©cifiques (‚Ç¨/pi√®ce)</label>
                            <input type="number" id="numeros_specifique_cost" step="0.01" value="2.00">
                        </div>

                        <hr style="margin: 30px 0; border: none; border-top: 1px solid #eee;">

                        <h4 style="margin-bottom: 15px;">Noms</h4>
                        <div class="toggle-group">
                            <label class="toggle-switch">
                                <input type="checkbox" id="allow_noms" checked>
                                <span class="toggle-slider"></span>
                            </label>
                            <label for="allow_noms">Autoriser les noms</label>
                        </div>
                        <div class="form-row" style="margin-top: 15px;">
                            <div class="toggle-group">
                                <label class="toggle-switch">
                                    <input type="checkbox" id="allow_noms_generique" checked>
                                    <span class="toggle-slider"></span>
                                </label>
                                <label for="allow_noms_generique">Noms g√©n√©riques (JOUEUR 1-20, gratuit)</label>
                            </div>
                            <div class="toggle-group">
                                <label class="toggle-switch">
                                    <input type="checkbox" id="allow_noms_specifique" checked>
                                    <span class="toggle-slider"></span>
                                </label>
                                <label for="allow_noms_specifique">Noms sp√©cifiques (payant)</label>
                            </div>
                        </div>
                        <div class="form-group" style="margin-top: 15px;">
                            <label>Co√ªt noms sp√©cifiques (‚Ç¨/pi√®ce)</label>
                            <input type="number" id="noms_specifique_cost" step="0.01" value="2.00">
                        </div>
                    </div>

                    <div class="form-section">
                        <h3>D√©lais et Options</h3>
                        <div class="form-row">
                            <div class="form-group">
                                <label>D√©lai standard (jours)</label>
                                <input type="number" id="default_lead_time_days" value="21">
                            </div>
                            <div class="form-group">
                                <label>Co√ªt suppl√©mentaire Sublimation (‚Ç¨)</label>
                                <input type="number" id="sublimation_extra_cost" step="0.01" value="0.00">
                            </div>
                            <div class="form-group">
                                <label>Co√ªt suppl√©mentaire Broderie (‚Ç¨)</label>
                                <input type="number" id="broderie_extra_cost" step="0.01" value="0.00">
                            </div>
                        </div>
                    </div>
                </div>

                <!-- TAB: Templates -->
                <div class="tab-pane" id="tab-templates">
                    <div class="form-section">
                        <h3>Galerie de Templates</h3>
                        <p style="margin-bottom: 20px; color: #666;">G√©rez les templates SVG disponibles dans le configurateur.</p>

                        <button class="btn btn-primary" onclick="uploadTemplate()">üì§ Uploader un Template SVG</button>
                        <input type="file" id="templateUpload" accept=".svg" style="display: none;" onchange="handleTemplateUpload(this)">

                        <div class="template-gallery" id="templateGallery">
                            <div class="empty-state">
                                <div class="loading"></div>
                                <p>Chargement des templates...</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- TAB: Guides Tailles -->
                <div class="tab-pane" id="tab-guides">
                    <div class="form-section">
                        <h3>Guides des Tailles Associ√©s</h3>
                        <p style="margin-bottom: 20px; color: #666;">S√©lectionnez les guides des tailles √† afficher pour ce produit.</p>

                        <div class="size-guide-list" id="sizeGuideList">
                            <div class="empty-state">
                                <div class="loading"></div>
                                <p>Chargement des guides...</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- TAB: Contenu -->
                <div class="tab-pane" id="tab-contenu">
                    <div class="form-section">
                        <h3>Descriptions et Contenu</h3>
                        <div class="form-group">
                            <label>Description SEO</label>
                            <textarea id="description_seo"></textarea>
                        </div>
                        <div class="form-group">
                            <label>Meta Title</label>
                            <input type="text" id="meta_title">
                        </div>
                        <div class="form-group">
                            <label>Meta Description</label>
                            <textarea id="meta_description" style="min-height: 60px;"></textarea>
                        </div>
                        <div class="form-group">
                            <label>URL Slug</label>
                            <input type="text" id="slug">
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Save Bar -->
    <div class="save-bar" id="saveBar">
        <div class="save-bar-message">
            <span>‚ö†Ô∏è</span>
            <span>Vous avez des modifications non sauvegard√©es</span>
        </div>
        <div class="save-bar-actions">
            <button class="btn btn-secondary" onclick="discardChanges()">Annuler</button>
            <button class="btn btn-success" onclick="saveAll()">üíæ Sauvegarder</button>
        </div>
    </div>

    <script>
        // Variables globales
        let currentProductId = null;
        let hasUnsavedChanges = false;
        let allProducts = [];
        let currentProductData = {};
        let currentPhotos = [];
        let currentTemplates = [];
        let currentGuides = [];
        let currentConfig = {};

        // Initialisation
        document.addEventListener('DOMContentLoaded', function() {
            loadProducts();
            setupTabs();
            setupChangeDetection();
        });

        // ===== CHARGEMENT PRODUITS =====
        async function loadProducts() {
            try {
                const response = await fetch('../api/products.php');
                const data = await response.json();

                if (data.success && data.products) {
                    allProducts = data.products;
                    displayProducts(allProducts);
                }
            } catch (error) {
                console.error('Erreur chargement produits:', error);
            }
        }

        function displayProducts(products) {
            const list = document.getElementById('productList');

            if (products.length === 0) {
                list.innerHTML = '<div class="empty-state"><p>Aucun produit trouv√©</p></div>';
                return;
            }

            list.innerHTML = products.map(p => `
                <div class="product-item" onclick="selectProduct(${p.id})">
                    <div class="product-item-ref">${p.reference}</div>
                    <div class="product-item-name">${p.nom}</div>
                    <div class="product-item-sport">${p.sport || ''} ${p.famille ? '‚Ä¢ ' + p.famille : ''}</div>
                </div>
            `).join('');
        }

        // Recherche produits
        document.getElementById('searchProducts').addEventListener('input', function(e) {
            const search = e.target.value.toLowerCase();
            const filtered = allProducts.filter(p =>
                p.nom.toLowerCase().includes(search) ||
                p.reference.toLowerCase().includes(search) ||
                (p.sport && p.sport.toLowerCase().includes(search))
            );
            displayProducts(filtered);
        });

        // ===== S√âLECTION PRODUIT =====
        async function selectProduct(productId) {
            if (hasUnsavedChanges) {
                if (!confirm('Vous avez des modifications non sauvegard√©es. Continuer ?')) {
                    return;
                }
            }

            currentProductId = productId;
            hasUnsavedChanges = false;
            document.getElementById('saveBar').classList.remove('show');

            // Highlight dans la sidebar
            document.querySelectorAll('.product-item').forEach(item => item.classList.remove('active'));
            event.target.closest('.product-item').classList.add('active');

            // Charge toutes les donn√©es
            await loadProductData(productId);
            await loadProductPhotos(productId);
            await loadProductConfig(productId);
            await loadTemplates();
            await loadSizeGuides();
        }

        async function loadProductData(productId) {
            try {
                const response = await fetch(`../api/products.php?id=${productId}`);
                const data = await response.json();

                if (data.success && data.product) {
                    currentProductData = data.product;
                    populateProductForm(data.product);
                }
            } catch (error) {
                console.error('Erreur chargement produit:', error);
            }
        }

        function populateProductForm(product) {
            document.getElementById('currentProductName').textContent = product.nom;

            // Infos g√©n√©rales
            document.getElementById('reference').value = product.reference || '';
            document.getElementById('nom').value = product.nom || '';
            document.getElementById('sport').value = product.sport || '';
            document.getElementById('famille').value = product.famille || '';
            document.getElementById('genre').value = product.genre || 'Mixte';
            document.getElementById('tissu').value = product.tissu || '';
            document.getElementById('grammage').value = product.grammage || '';
            document.getElementById('description').value = product.description || '';

            // Prix
            for (let tier of ['1', '5', '10', '20', '50', '100', '250', '500']) {
                document.getElementById(`prix_${tier}`).value = product[`prix_${tier}`] || '';
            }

            // Contenu
            document.getElementById('description_seo').value = product.description_seo || '';
            document.getElementById('meta_title').value = product.meta_title || '';
            document.getElementById('meta_description').value = product.meta_description || '';
            document.getElementById('slug').value = product.slug || '';
        }

        async function loadProductPhotos(productId) {
            try {
                const response = await fetch(`../api/product-photos.php?product_id=${productId}`);
                const data = await response.json();

                if (data.success) {
                    currentPhotos = data.photos || [];
                    displayPhotos(currentPhotos);
                }
            } catch (error) {
                console.error('Erreur chargement photos:', error);
            }
        }

        function displayPhotos(photos) {
            const gallery = document.getElementById('photoGallery');

            if (photos.length === 0) {
                gallery.innerHTML = '<div class="empty-state"><p>Aucune photo. Uploadez-en une !</p></div>';
                return;
            }

            gallery.innerHTML = photos.map((photo, index) => `
                <div class="photo-item" draggable="true" data-photo-id="${photo.id}">
                    <img src="${photo.url}" alt="${photo.alt_text || ''}">
                    <div class="photo-item-badge">#${index + 1}</div>
                    <div class="photo-item-actions">
                        <button class="btn btn-danger btn-small" onclick="deletePhoto(${photo.id})">üóë</button>
                    </div>
                </div>
            `).join('');
        }

        async function loadProductConfig(productId) {
            try {
                const response = await fetch(`../api/configurator-settings.php?product_id=${productId}`);
                const data = await response.json();

                if (data.success && data.config) {
                    currentConfig = data.config;
                    populateConfigForm(data.config);
                } else {
                    // Pas de config -> valeurs par d√©faut
                    populateConfigForm(getDefaultConfig());
                }
            } catch (error) {
                console.error('Erreur chargement config:', error);
            }
        }

        function getDefaultConfig() {
            return {
                allow_design_flare: true,
                allow_design_client: true,
                allow_design_template: true,
                design_flare_extra_cost: 50.00,
                available_col_options_data: ['Rond', 'V', 'Polo'],
                available_manches_options_data: ['Courtes', 'Longues', 'Sans manches'],
                available_poches_options_data: ['Oui', 'Non'],
                available_fermeture_options_data: ['√âlastique', 'Zip', 'Boutons'],
                allow_genre_homme: true,
                allow_genre_femme: true,
                allow_genre_mixte: true,
                allow_genre_enfant: true,
                enfant_discount_percent: 10.00,
                available_sizes_data: ['XS', 'S', 'M', 'L', 'XL', 'XXL', '3XL', '4XL'],
                min_total_quantity: 1,
                max_total_quantity: 9999,
                allow_colors: true,
                default_colors_data: ['#FF4B26', '#1a1a1a', '#ffffff'],
                allow_logos: true,
                logo_extra_cost: 0.00,
                allow_numeros: true,
                allow_numeros_generique: true,
                allow_numeros_specifique: true,
                numeros_specifique_cost: 2.00,
                allow_noms: true,
                allow_noms_generique: true,
                allow_noms_specifique: true,
                noms_specifique_cost: 2.00,
                default_lead_time_days: 21,
                sublimation_extra_cost: 0.00,
                broderie_extra_cost: 0.00
            };
        }

        function populateConfigForm(config) {
            // √âtape 1: Design
            document.getElementById('allow_design_flare').checked = config.allow_design_flare !== false;
            document.getElementById('allow_design_client').checked = config.allow_design_client !== false;
            document.getElementById('allow_design_template').checked = config.allow_design_template !== false;
            document.getElementById('design_flare_extra_cost').value = config.design_flare_extra_cost || 50.00;

            // √âtape 2: Options
            document.getElementById('available_col_options').value = Array.isArray(config.available_col_options_data) ? config.available_col_options_data.join(', ') : '';
            document.getElementById('available_manches_options').value = Array.isArray(config.available_manches_options_data) ? config.available_manches_options_data.join(', ') : '';
            document.getElementById('available_poches_options').value = Array.isArray(config.available_poches_options_data) ? config.available_poches_options_data.join(', ') : '';
            document.getElementById('available_fermeture_options').value = Array.isArray(config.available_fermeture_options_data) ? config.available_fermeture_options_data.join(', ') : '';

            // √âtape 3: Genre
            document.getElementById('allow_genre_homme').checked = config.allow_genre_homme !== false;
            document.getElementById('allow_genre_femme').checked = config.allow_genre_femme !== false;
            document.getElementById('allow_genre_mixte').checked = config.allow_genre_mixte !== false;
            document.getElementById('allow_genre_enfant').checked = config.allow_genre_enfant !== false;
            document.getElementById('enfant_discount_percent').value = config.enfant_discount_percent || 10.00;

            // √âtape 4: Tailles
            const availableSizes = config.available_sizes_data || [];
            ['XS', 'S', 'M', 'L', 'XL', 'XXL', '3XL', '4XL'].forEach(size => {
                const checkbox = document.getElementById(`size_${size.toLowerCase().replace('xl', 'xl')}`);
                if (checkbox) checkbox.checked = availableSizes.includes(size);
            });
            document.getElementById('min_total_quantity').value = config.min_total_quantity || 1;
            document.getElementById('max_total_quantity').value = config.max_total_quantity || 9999;

            // √âtape 5: Personnalisation
            document.getElementById('allow_colors').checked = config.allow_colors !== false;

            // Couleurs
            const colors = config.default_colors_data || ['#FF4B26', '#1a1a1a', '#ffffff'];
            displayColors(colors);

            document.getElementById('allow_logos').checked = config.allow_logos !== false;
            document.getElementById('logo_extra_cost').value = config.logo_extra_cost || 0.00;

            document.getElementById('allow_numeros').checked = config.allow_numeros !== false;
            document.getElementById('allow_numeros_generique').checked = config.allow_numeros_generique !== false;
            document.getElementById('allow_numeros_specifique').checked = config.allow_numeros_specifique !== false;
            document.getElementById('numeros_specifique_cost').value = config.numeros_specifique_cost || 2.00;

            document.getElementById('allow_noms').checked = config.allow_noms !== false;
            document.getElementById('allow_noms_generique').checked = config.allow_noms_generique !== false;
            document.getElementById('allow_noms_specifique').checked = config.allow_noms_specifique !== false;
            document.getElementById('noms_specifique_cost').value = config.noms_specifique_cost || 2.00;

            // D√©lais
            document.getElementById('default_lead_time_days').value = config.default_lead_time_days || 21;
            document.getElementById('sublimation_extra_cost').value = config.sublimation_extra_cost || 0.00;
            document.getElementById('broderie_extra_cost').value = config.broderie_extra_cost || 0.00;
        }

        function displayColors(colors) {
            const grid = document.getElementById('colorGrid');
            grid.innerHTML = colors.map((color, index) => `
                <div class="color-item">
                    <input type="color" class="color-preview" value="${color}" data-index="${index}">
                    <input type="text" class="color-hex" value="${color}" data-index="${index}">
                    <button class="btn btn-danger btn-small" onclick="removeColor(${index})">√ó</button>
                </div>
            `).join('');

            // Event listeners pour sync color picker et hex
            grid.querySelectorAll('.color-preview').forEach(input => {
                input.addEventListener('change', function() {
                    const index = this.dataset.index;
                    grid.querySelector(`.color-hex[data-index="${index}"]`).value = this.value;
                    markAsChanged();
                });
            });

            grid.querySelectorAll('.color-hex').forEach(input => {
                input.addEventListener('input', function() {
                    const index = this.dataset.index;
                    if (/^#[0-9A-F]{6}$/i.test(this.value)) {
                        grid.querySelector(`.color-preview[data-index="${index}"]`).value = this.value;
                    }
                    markAsChanged();
                });
            });
        }

        function addColor() {
            const grid = document.getElementById('colorGrid');
            const currentColors = Array.from(grid.querySelectorAll('.color-hex')).map(input => input.value);
            currentColors.push('#000000');
            displayColors(currentColors);
            markAsChanged();
        }

        function removeColor(index) {
            const grid = document.getElementById('colorGrid');
            const currentColors = Array.from(grid.querySelectorAll('.color-hex')).map(input => input.value);
            currentColors.splice(index, 1);
            displayColors(currentColors);
            markAsChanged();
        }

        async function loadTemplates() {
            try {
                const response = await fetch('../api/templates-manager.php');
                const data = await response.json();

                if (data.success) {
                    currentTemplates = data.templates || [];
                    displayTemplates(currentTemplates);
                }
            } catch (error) {
                console.error('Erreur chargement templates:', error);
            }
        }

        function displayTemplates(templates) {
            const gallery = document.getElementById('templateGallery');

            if (templates.length === 0) {
                gallery.innerHTML = '<div class="empty-state"><p>Aucun template. Uploadez-en un !</p></div>';
                return;
            }

            gallery.innerHTML = templates.map(template => `
                <div class="template-item">
                    <div class="template-item-preview">
                        <img src="${template.path}" alt="${template.nom || template.filename}">
                    </div>
                    <div class="template-item-info">
                        <div class="template-item-name">${template.nom || template.filename}</div>
                        <div class="template-item-tags">${template.sport || ''} ${template.famille ? '‚Ä¢ ' + template.famille : ''}</div>
                    </div>
                    <div class="template-item-actions">
                        <button class="btn btn-primary btn-small" onclick="editTemplate(${template.id})">‚úèÔ∏è</button>
                        <button class="btn btn-danger btn-small" onclick="deleteTemplate(${template.id})">üóë</button>
                    </div>
                </div>
            `).join('');
        }

        async function loadSizeGuides() {
            try {
                const response = await fetch('../api/size-guides.php');
                const dataAll = await response.json();

                const responseProduct = await fetch(`../api/size-guides.php?product_id=${currentProductId}`);
                const dataProduct = await responseProduct.json();

                if (dataAll.success) {
                    currentGuides = dataAll.guides || [];
                    const associatedGuideIds = (dataProduct.guides || []).map(g => g.id);
                    displaySizeGuides(currentGuides, associatedGuideIds);
                }
            } catch (error) {
                console.error('Erreur chargement guides:', error);
            }
        }

        function displaySizeGuides(guides, associatedIds = []) {
            const list = document.getElementById('sizeGuideList');

            if (guides.length === 0) {
                list.innerHTML = '<div class="empty-state"><p>Aucun guide des tailles disponible</p></div>';
                return;
            }

            list.innerHTML = guides.map(guide => `
                <div class="size-guide-item ${associatedIds.includes(guide.id) ? 'selected' : ''}" onclick="toggleGuide(${guide.id})">
                    <div class="size-guide-info">
                        <h4>${guide.titre}</h4>
                        <div class="size-guide-meta">
                            ${guide.sport || 'Tous sports'} ‚Ä¢ ${guide.categorie} ‚Ä¢ ${guide.genre || 'Mixte'}
                        </div>
                    </div>
                    <div>
                        ${associatedIds.includes(guide.id) ? '<span class="badge badge-primary">‚úì Associ√©</span>' : '<span class="badge badge-secondary">Cliquer pour associer</span>'}
                    </div>
                </div>
            `).join('');
        }

        async function toggleGuide(guideId) {
            const item = event.target.closest('.size-guide-item');
            const isSelected = item.classList.contains('selected');

            try {
                if (isSelected) {
                    // Dissocier
                    const response = await fetch(`../api/size-guides.php?product_id=${currentProductId}`);
                    const data = await response.json();
                    const association = data.guides.find(g => g.id === guideId);

                    if (association) {
                        await fetch(`../api/size-guides.php?action=disassociate&id=${association.association_id}`, {
                            method: 'DELETE'
                        });
                    }

                    item.classList.remove('selected');
                    item.querySelector('.badge').className = 'badge badge-secondary';
                    item.querySelector('.badge').textContent = 'Cliquer pour associer';
                } else {
                    // Associer
                    await fetch('../api/size-guides.php?action=associate', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            product_id: currentProductId,
                            guide_id: guideId
                        })
                    });

                    item.classList.add('selected');
                    item.querySelector('.badge').className = 'badge badge-primary';
                    item.querySelector('.badge').textContent = '‚úì Associ√©';
                }
            } catch (error) {
                console.error('Erreur toggle guide:', error);
                alert('Erreur lors de l\'association du guide');
            }
        }

        // ===== UPLOAD PHOTO =====
        async function uploadPhoto(input) {
            if (!input.files || !input.files[0]) return;

            const formData = new FormData();
            formData.append('file', input.files[0]);

            try {
                const response = await fetch('../api/product-photos.php?action=upload', {
                    method: 'POST',
                    body: formData
                });
                const data = await response.json();

                if (data.success) {
                    // Ajoute la photo √† la BDD
                    await fetch('../api/product-photos.php', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            product_id: currentProductId,
                            url: data.file.url,
                            filename: data.file.filename,
                            width: data.file.width,
                            height: data.file.height,
                            size_bytes: data.file.size,
                            mime_type: data.file.mime_type,
                            type: 'gallery'
                        })
                    });

                    // Recharge les photos
                    await loadProductPhotos(currentProductId);
                    alert('Photo upload√©e avec succ√®s !');
                }
            } catch (error) {
                console.error('Erreur upload photo:', error);
                alert('Erreur lors de l\'upload');
            }

            input.value = '';
        }

        async function deletePhoto(photoId) {
            if (!confirm('Supprimer cette photo ?')) return;

            try {
                await fetch(`../api/product-photos.php?id=${photoId}`, {
                    method: 'DELETE'
                });

                await loadProductPhotos(currentProductId);
            } catch (error) {
                console.error('Erreur suppression photo:', error);
                alert('Erreur lors de la suppression');
            }
        }

        // ===== UPLOAD TEMPLATE =====
        function uploadTemplate() {
            document.getElementById('templateUpload').click();
        }

        async function handleTemplateUpload(input) {
            if (!input.files || !input.files[0]) return;

            const formData = new FormData();
            formData.append('file', input.files[0]);

            try {
                const response = await fetch('../api/templates-manager.php?action=upload', {
                    method: 'POST',
                    body: formData
                });
                const data = await response.json();

                if (data.success) {
                    // Ajoute le template √† la BDD
                    await fetch('../api/templates-manager.php', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            filename: data.file.filename,
                            path: data.file.path,
                            preview_url: data.file.url,
                            svg_content: data.file.svg_content,
                            width: data.file.width,
                            height: data.file.height,
                            type: 'svg',
                            active: true
                        })
                    });

                    // Recharge les templates
                    await loadTemplates();
                    alert('Template upload√© avec succ√®s !');
                }
            } catch (error) {
                console.error('Erreur upload template:', error);
                alert('Erreur lors de l\'upload');
            }

            input.value = '';
        }

        async function deleteTemplate(templateId) {
            if (!confirm('Supprimer ce template ?')) return;

            try {
                await fetch(`../api/templates-manager.php?id=${templateId}`, {
                    method: 'DELETE'
                });

                await loadTemplates();
            } catch (error) {
                console.error('Erreur suppression template:', error);
                alert('Erreur lors de la suppression');
            }
        }

        function editTemplate(templateId) {
            alert('Fonctionnalit√© d\'√©dition √† venir !');
        }

        // ===== SAUVEGARDE =====
        async function saveAll() {
            if (!currentProductId) {
                alert('Aucun produit s√©lectionn√©');
                return;
            }

            try {
                // 1. Sauvegarde infos produit
                const productData = {
                    reference: document.getElementById('reference').value,
                    nom: document.getElementById('nom').value,
                    sport: document.getElementById('sport').value,
                    famille: document.getElementById('famille').value,
                    genre: document.getElementById('genre').value,
                    tissu: document.getElementById('tissu').value,
                    grammage: document.getElementById('grammage').value,
                    description: document.getElementById('description').value,
                    prix_1: parseFloat(document.getElementById('prix_1').value) || null,
                    prix_5: parseFloat(document.getElementById('prix_5').value) || null,
                    prix_10: parseFloat(document.getElementById('prix_10').value) || null,
                    prix_20: parseFloat(document.getElementById('prix_20').value) || null,
                    prix_50: parseFloat(document.getElementById('prix_50').value) || null,
                    prix_100: parseFloat(document.getElementById('prix_100').value) || null,
                    prix_250: parseFloat(document.getElementById('prix_250').value) || null,
                    prix_500: parseFloat(document.getElementById('prix_500').value) || null,
                    description_seo: document.getElementById('description_seo').value,
                    meta_title: document.getElementById('meta_title').value,
                    meta_description: document.getElementById('meta_description').value,
                    slug: document.getElementById('slug').value
                };

                await fetch(`../api/products.php?id=${currentProductId}`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(productData)
                });

                // 2. Sauvegarde config configurateur
                const configData = {
                    product_id: currentProductId,
                    allow_design_flare: document.getElementById('allow_design_flare').checked,
                    allow_design_client: document.getElementById('allow_design_client').checked,
                    allow_design_template: document.getElementById('allow_design_template').checked,
                    design_flare_extra_cost: parseFloat(document.getElementById('design_flare_extra_cost').value),
                    available_col_options: document.getElementById('available_col_options').value.split(',').map(s => s.trim()).filter(s => s),
                    available_manches_options: document.getElementById('available_manches_options').value.split(',').map(s => s.trim()).filter(s => s),
                    available_poches_options: document.getElementById('available_poches_options').value.split(',').map(s => s.trim()).filter(s => s),
                    available_fermeture_options: document.getElementById('available_fermeture_options').value.split(',').map(s => s.trim()).filter(s => s),
                    allow_genre_homme: document.getElementById('allow_genre_homme').checked,
                    allow_genre_femme: document.getElementById('allow_genre_femme').checked,
                    allow_genre_mixte: document.getElementById('allow_genre_mixte').checked,
                    allow_genre_enfant: document.getElementById('allow_genre_enfant').checked,
                    enfant_discount_percent: parseFloat(document.getElementById('enfant_discount_percent').value),
                    available_sizes: ['XS', 'S', 'M', 'L', 'XL', 'XXL', '3XL', '4XL'].filter(size => {
                        const checkbox = document.getElementById(`size_${size.toLowerCase().replace('xl', 'xl')}`);
                        return checkbox && checkbox.checked;
                    }),
                    min_total_quantity: parseInt(document.getElementById('min_total_quantity').value),
                    max_total_quantity: parseInt(document.getElementById('max_total_quantity').value),
                    allow_colors: document.getElementById('allow_colors').checked,
                    default_colors: Array.from(document.querySelectorAll('#colorGrid .color-hex')).map(input => input.value),
                    allow_logos: document.getElementById('allow_logos').checked,
                    logo_extra_cost: parseFloat(document.getElementById('logo_extra_cost').value),
                    allow_numeros: document.getElementById('allow_numeros').checked,
                    allow_numeros_generique: document.getElementById('allow_numeros_generique').checked,
                    allow_numeros_specifique: document.getElementById('allow_numeros_specifique').checked,
                    numeros_specifique_cost: parseFloat(document.getElementById('numeros_specifique_cost').value),
                    allow_noms: document.getElementById('allow_noms').checked,
                    allow_noms_generique: document.getElementById('allow_noms_generique').checked,
                    allow_noms_specifique: document.getElementById('allow_noms_specifique').checked,
                    noms_specifique_cost: parseFloat(document.getElementById('noms_specifique_cost').value),
                    default_lead_time_days: parseInt(document.getElementById('default_lead_time_days').value),
                    sublimation_extra_cost: parseFloat(document.getElementById('sublimation_extra_cost').value),
                    broderie_extra_cost: parseFloat(document.getElementById('broderie_extra_cost').value)
                };

                await fetch(`../api/configurator-settings.php?product_id=${currentProductId}`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(configData)
                });

                hasUnsavedChanges = false;
                document.getElementById('saveBar').classList.remove('show');
                alert('‚úÖ Toutes les modifications ont √©t√© sauvegard√©es !');

            } catch (error) {
                console.error('Erreur sauvegarde:', error);
                alert('‚ùå Erreur lors de la sauvegarde');
            }
        }

        function reloadProduct() {
            if (currentProductId) {
                selectProduct(currentProductId);
            }
        }

        function discardChanges() {
            if (confirm('Annuler toutes les modifications ?')) {
                reloadProduct();
            }
        }

        // ===== TABS =====
        function setupTabs() {
            document.querySelectorAll('.tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    const targetTab = this.dataset.tab;

                    // Active le tab
                    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                    this.classList.add('active');

                    // Affiche le contenu
                    document.querySelectorAll('.tab-pane').forEach(pane => pane.classList.remove('active'));
                    document.getElementById(`tab-${targetTab}`).classList.add('active');
                });
            });
        }

        // ===== CHANGE DETECTION =====
        function setupChangeDetection() {
            const inputs = document.querySelectorAll('input, select, textarea');
            inputs.forEach(input => {
                input.addEventListener('input', markAsChanged);
                input.addEventListener('change', markAsChanged);
            });
        }

        function markAsChanged() {
            hasUnsavedChanges = true;
            document.getElementById('saveBar').classList.add('show');
        }

        // Warning avant quitter
        window.addEventListener('beforeunload', function(e) {
            if (hasUnsavedChanges) {
                e.preventDefault();
                e.returnValue = '';
            }
        });
    </script>
</body>
</html>
